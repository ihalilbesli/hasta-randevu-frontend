<app-header></app-header>
<h2>Åikayet YÃ¶netimi</h2>

<!-- ğŸ” Filtre AlanÄ± -->
<div class="filter-container">
  <select [(ngModel)]="statusFilter" (change)="filterComplaints()">
    <option value="">Durum (TÃ¼mÃ¼)</option>
     <option value="BEKLEMEDE">Beklemede</option>
    <option value="INCELEMEDE">Ä°ncelemede</option>
    <option value="COZULDU">Ã‡Ã¶zÃ¼ldÃ¼</option>
  </select>

 <input type="text" placeholder="Ä°sim ile ara..." [(ngModel)]="searchKeyword" (input)="filterComplaints()">
</div>

<!-- ğŸ“‹ Åikayet Listesi -->
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>KullanÄ±cÄ±</th>
      <th>Konu</th>
      <th>Ä°Ã§erik</th>
      <th>Klinik</th> <!-- EKLENDÄ° -->
      <th>Durum</th>
      <th>Admin Notu</th>
      <th>Ä°ÅŸlemler</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let complaint of filteredComplaints">
      <td>{{ complaint.id }}</td>
      <td>{{ complaint.user?.name }} {{ complaint.user?.surname }}</td>
      <td>{{ complaint.subject }}</td>
      <td>{{ complaint.content }}</td>
      <td>{{ complaint.clinic?.name || 'BelirtilmemiÅŸ' }}</td> 

      <!-- ğŸ“ GÃ¼ncelleme Modu -->
      <ng-container *ngIf="editingComplaintId === complaint.id; else showStatic">
        <td>
          <select [(ngModel)]="updatedStatus">
            <option value="BEKLEMEDE">BEKLEMEDE</option>
            <option value="INCELEMEDE">Ä°NCELEMEDE</option>
            <option value="COZULDU">Ã‡Ã–ZÃœLDÃœ</option>
          </select>
        </td>
        <td>
          <input [(ngModel)]="updatedNote" placeholder="Not giriniz" />
        </td>
        <td>
          <button (click)="saveEdit(complaint.id)">ğŸ’¾ Kaydet</button>
          <button (click)="cancelEdit()">âŒ Ä°ptal</button>
        </td>
      </ng-container>

      <!-- ğŸ“„ Normal GÃ¶rÃ¼nÃ¼m -->
      <ng-template #showStatic>
        <td>{{ complaint.status }}</td>
        <td>{{ complaint.adminNote || 'â€”' }}</td>
        <td>
          <button (click)="startEditing(complaint)">âœï¸ GÃ¼ncelle</button>
        </td>
      </ng-template>
    </tr>
  </tbody>
</table>
