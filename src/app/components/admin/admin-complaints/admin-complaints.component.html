<h2><i class="fa-solid fa-comments"></i> Åikayet YÃ¶netimi</h2>

<!-- ğŸ” Filtre AlanÄ± -->
<div class="filter-container">
  <select [(ngModel)]="statusFilter" (change)="filterComplaints()">
    <option value="">ğŸ“‚ Durum (TÃ¼mÃ¼)</option>
    <option value="BEKLEMEDE">â³ Beklemede</option>
    <option value="INCELEMEDE">ğŸ” Ä°ncelemede</option>
    <option value="COZULDU">âœ… Ã‡Ã¶zÃ¼ldÃ¼</option>
  </select>

  <input type="text" placeholder="ğŸ” Ä°sim ile ara..." [(ngModel)]="searchKeyword" (input)="filterComplaints()">
</div>

<!-- ğŸ“‹ Åikayet Listesi -->
<table>
  <thead>
    <tr>
      <th>ID</th>
      <th><i class="fa-solid fa-user"></i> KullanÄ±cÄ±</th>
      <th><i class="fa-solid fa-tag"></i> Konu</th>
      <th><i class="fa-solid fa-align-left"></i> Ä°Ã§erik</th>
      <th><i class="fa-solid fa-hospital"></i> Klinik</th> 
      <th><i class="fa-solid fa-flag"></i> Durum</th>
      <th><i class="fa-solid fa-note-sticky"></i> Admin Notu</th>
      <th><i class="fa-solid fa-gear"></i> Ä°ÅŸlemler</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let complaint of filteredComplaints">
      <td>{{ complaint.id }}</td>
      <td>{{ complaint.user?.name }} {{ complaint.user?.surname }}</td>
      <td>{{ complaint.subject }}</td>
      <td>{{ complaint.content }}</td>
      <td>{{ complaint.clinic?.name || 'BelirtilmemiÅŸ' }}</td> 

      <ng-container *ngIf="editingComplaintId === complaint.id; else showStatic">
        <td>
          <select [(ngModel)]="updatedStatus">
            <option value="BEKLEMEDE">â³ Beklemede</option>
            <option value="INCELEMEDE">ğŸ” Ä°ncelemede</option>
            <option value="COZULDU">âœ… Ã‡Ã¶zÃ¼ldÃ¼</option>
          </select>
        </td>
        <td>
          <input [(ngModel)]="updatedNote" placeholder="Not giriniz" />
        </td>
        <td>
          <button (click)="saveEdit(complaint.id)">
            <i class="fa-solid fa-floppy-disk"></i> Kaydet
          </button>
          <button (click)="cancelEdit()">
            <i class="fa-solid fa-xmark"></i> Ä°ptal
          </button>
        </td>
      </ng-container>

      <ng-template #showStatic>
        <td [ngClass]="{
          'status-beklemede': complaint.status === 'BEKLEMEDE',
          'status-incelemede': complaint.status === 'INCELEMEDE',
          'status-cozuldu': complaint.status === 'COZULDU'
        }">{{ complaint.status }}</td>
        <td>{{ complaint.adminNote || 'â€”' }}</td>
        <td>
          <button (click)="startEditing(complaint)">
            <i class="fa-solid fa-pen-to-square"></i> GÃ¼ncelle
          </button>
        </td>
      </ng-template>
    </tr>
  </tbody>
</table>
