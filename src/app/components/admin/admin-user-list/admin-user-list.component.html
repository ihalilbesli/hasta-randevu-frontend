<app-header></app-header>
<h2>KullanÄ±cÄ± YÃ¶netimi</h2>

<!-- ğŸ”˜ Rol SeÃ§imi -->
<div class="role-buttons">
  <button (click)="selectRole('HASTA')">ğŸ‘¤ Hastalar</button>
  <button (click)="selectRole('DOKTOR')">ğŸ©º Doktorlar</button>
  <button (click)="selectRole('ADMIN')">ğŸ›¡ï¸ Adminler</button>
</div>

<!-- ğŸ” Filtre AlanlarÄ± -->
<div class="filter-container">
  <input type="text" placeholder="Ä°sme gÃ¶re ara" [(ngModel)]="nameFilter" (input)="filterUsers()">
  <input type="text" placeholder="E-posta ile ara" [(ngModel)]="emailFilter" (input)="filterUsers()">

  <select [(ngModel)]="genderFilter" (change)="filterUsers()">
    <option value="">Cinsiyet (TÃ¼mÃ¼)</option>
    <option value="ERKEK">Erkek</option>
    <option value="KADIN">KadÄ±n</option>
    <option value="BELIRTILMEMIS">BelirtilmemiÅŸ</option>
  </select>

  <select *ngIf="selectedRole === 'HASTA'" [(ngModel)]="bloodTypeFilter" (change)="filterUsers()">
    <option value="">Kan Grubu (TÃ¼mÃ¼)</option>
    <option value="ARH_POS">A Rh+</option>
    <option value="ARH_NEG">A Rh-</option>
    <option value="BRH_POS">B Rh+</option>
    <option value="BRH_NEG">B Rh-</option>
    <option value="ABRH_POS">AB Rh+</option>
    <option value="ABRH_NEG">AB Rh-</option>
    <option value="ORH_POS">O Rh+</option>
    <option value="ORH_NEG">O Rh-</option>
  </select>

  <input *ngIf="selectedRole === 'DOKTOR'"
   type="text"
    placeholder="UzmanlÄ±k (Doktorlar)" 
    [(ngModel)]="specializationFilter"
     (input)="filterUsers()">
    </div>

<!-- â• Ekle Butonu -->
<button (click)="toggleNewUserForm()">â• Yeni {{ selectedRole }} Ekle</button>

<!-- â• Yeni KullanÄ±cÄ± Ekleme Formu -->
<div *ngIf="showNewUserForm">
  <h3>Yeni {{ selectedRole }} Ekle</h3>
  <form (ngSubmit)="createUser()" class="new-user-form">
    <input [(ngModel)]="newUser.name" name="name" placeholder="Ad">
    <input [(ngModel)]="newUser.surname" name="surname" placeholder="Soyad">
    <input [(ngModel)]="newUser.email" name="email" placeholder="Email">
    <input [(ngModel)]="newUser.password" name="password" placeholder="Åifre" type="password">
    <input [(ngModel)]="newUser.phoneNumber" name="phoneNumber" placeholder="Telefon">
    <input [(ngModel)]="newUser.birthDate" name="birthDate" type="date">

    <select [(ngModel)]="newUser.gender" name="gender">
      <option value="ERKEK">Erkek</option>
      <option value="KADIN">KadÄ±n</option>
      <option value="BELIRTILMEMIS">BelirtilmemiÅŸ</option>
    </select>

    <!-- Doktor iÃ§in alan -->
    <div *ngIf="selectedRole === 'DOKTOR'">
      <input [(ngModel)]="newUser.specialization" name="specialization" placeholder="UzmanlÄ±k">
    </div>

    <!-- Hasta iÃ§in alan -->
    <div *ngIf="selectedRole === 'HASTA'">
      <select [(ngModel)]="newUser.bloodType" name="bloodType">
        <option value="ARH_POS">A Rh+</option>
        <option value="ARH_NEG">A Rh-</option>
        <option value="BRH_POS">B Rh+</option>
        <option value="BRH_NEG">B Rh-</option>
        <option value="ABRH_POS">AB Rh+</option>
        <option value="ABRH_NEG">AB Rh-</option>
        <option value="ORH_POS">O Rh+</option>
        <option value="ORH_NEG">O Rh-</option>
      </select>
      <input [(ngModel)]="newUser.chronicDiseases" name="chronicDiseases" placeholder="Kronik RahatsÄ±zlÄ±k">
    </div>

    <button type="submit">â• Ekle</button>
  </form>
</div>

<!-- ğŸ“‹ KullanÄ±cÄ± Listesi -->
<h3>{{ selectedRole }} Listesi</h3>
<table>
  <thead>
    <tr>
      <th>Ad</th>
      <th>Soyad</th>
      <th>Email</th>
      <th>Telefon</th>
      <th>Rol</th>
      <th>UzmanlÄ±k</th>
      <th>Ä°ÅŸlemler</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of filteredUsers">
      <td>{{ user.name }}</td>
      <td>{{ user.surname }}</td>
      <td>{{ user.email }}</td>
      <td>{{ user.phoneNumber }}</td>
      <td>{{ user.role }}</td>
      <td>{{ user.role === 'DOKTOR' ? user.specialization : '-' }}</td>
      <td>
        <button (click)="updateUser(user)">âœï¸ GÃ¼ncelle</button>
        <button (click)="deleteUser(user.id)">ğŸ—‘ï¸ Sil</button>
        <button (click)="goToUserDetails(user.id)">ğŸ” Detay</button>
      </td>
    </tr>
  </tbody>
</table>

<!-- âœï¸ GÃ¼ncelleme ModalÄ± -->
<div class="modal-backdrop" *ngIf="showEditModal">
  <div class="modal">
    <h3>KullanÄ±cÄ±yÄ± GÃ¼ncelle</h3>
    <form (ngSubmit)="saveEditUser()">
      <label>Ad:</label>
      <input [(ngModel)]="editedUser.name" name="name">

      <label>Soyad:</label>
      <input [(ngModel)]="editedUser.surname" name="surname">

      <label>Email:</label>
      <input [(ngModel)]="editedUser.email" name="email">

      <label>Telefon:</label>
      <input [(ngModel)]="editedUser.phoneNumber" name="phoneNumber">

      <label>DoÄŸum Tarihi:</label>
      <input type="date" [(ngModel)]="editedUser.birthDate" name="birthDate">

      <label>Rol:</label>
      <select [(ngModel)]="editedUser.role" name="role">
        <option value="HASTA">Hasta</option>
        <option value="DOKTOR">Doktor</option>
        <option value="ADMIN">Admin</option>
      </select>

      <label>Cinsiyet:</label>
      <select [(ngModel)]="editedUser.gender" name="gender">
        <option value="ERKEK">Erkek</option>
        <option value="KADIN">KadÄ±n</option>
        <option value="BELIRTILMEMIS">BelirtilmemiÅŸ</option>
      </select>

      <div *ngIf="editedUser.role === 'DOKTOR'">
        <label>UzmanlÄ±k:</label>
        <input [(ngModel)]="editedUser.specialization" name="specialization">
      </div>

      <div *ngIf="editedUser.role === 'HASTA'">
        <label>Kan Grubu:</label>
        <select [(ngModel)]="editedUser.bloodType" name="bloodType">
          <option value="ARH_POS">A Rh+</option>
          <option value="ARH_NEG">A Rh-</option>
          <option value="BRH_POS">B Rh+</option>
          <option value="BRH_NEG">B Rh-</option>
          <option value="ABRH_POS">AB Rh+</option>
          <option value="ABRH_NEG">AB Rh-</option>
          <option value="ORH_POS">O Rh+</option>
          <option value="ORH_NEG">O Rh-</option>
        </select>

        <label>Kronik RahatsÄ±zlÄ±k:</label>
        <input [(ngModel)]="editedUser.chronicDiseases" name="chronicDiseases">
      </div>

      <div class="modal-buttons">
        <button type="submit">ğŸ’¾ Kaydet</button>
        <button type="button" (click)="closeEditModal()">âŒ Kapat</button>
      </div>
    </form>
  </div>
</div>
