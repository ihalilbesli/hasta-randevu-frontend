<!-- ğŸ”˜ Randevulu / Randevusuz SeÃ§imi -->
<div class="form-group">
  <button (click)="selectPatientMode('today')" [disabled]="patientMode === 'today'">
    <i class="fa-solid fa-calendar-check"></i> Randevulu Hastalar
  </button>
  <button (click)="selectPatientMode('all')" [disabled]="patientMode === 'all'">
    <i class="fa-solid fa-users"></i> Randevusuz Hastalar
  </button>
</div>

<!-- ğŸ§‘â€âš•ï¸ Hasta SeÃ§imi -->
<div class="form-group">
  <label><i class="fa-solid fa-user-injured"></i> Hasta SeÃ§in:</label>
  <select [(ngModel)]="selectedPatientId" (change)="onPatientChange()">
    <option [value]="null">-- Hasta SeÃ§in --</option>
    <option *ngFor="let patient of patients" [value]="patient.id">
      {{ patient.name }} {{ patient.surname }} 
    </option>
  </select>
</div>

<!-- GeÃ§iÅŸ ButonlarÄ± -->
<div *ngIf="selectedPatientId && activeTab === ''" class="form-group">
  <button *ngIf="patientMode === 'today'" (click)="selectTab('add')">
    <i class="fa-solid fa-plus"></i> GeÃ§miÅŸ Ekle
  </button>
  <button (click)="selectTab('list')">
    <i class="fa-solid fa-folder-open"></i> GeÃ§miÅŸleri GÃ¶r
  </button>
</div>

<!-- â• GeÃ§miÅŸ Ekleme -->
<div *ngIf="activeTab === 'add'">
  <button (click)="activeTab = ''"><i class="fa-solid fa-arrow-left"></i> Geri</button>
  <h3><i class="fa-solid fa-notes-medical"></i> {{ editingHistoryId ? 'GeÃ§miÅŸi GÃ¼ncelle' : 'Yeni GeÃ§miÅŸ Ekle' }}</h3>

  <div class="form-group">
    <label><i class="fa-solid fa-stethoscope"></i> TanÄ± *</label>
    <input type="text" [(ngModel)]="diagnosis" placeholder="TanÄ± girin" />
  </div>

  <div class="form-group">
    <label><i class="fa-solid fa-syringe"></i> Tedavi</label>
    <input type="text" [(ngModel)]="treatment" placeholder="Tedavi bilgisi (opsiyonel)" />
  </div>

  <div class="form-group">
    <label><i class="fa-solid fa-note-sticky"></i> Notlar</label>
    <textarea [(ngModel)]="notes" placeholder="Varsa notlar"></textarea>
  </div>

  <button (click)="createOrUpdateHistory()">
    <i class="fa-solid fa-save"></i> {{ editingHistoryId ? 'GÃ¼ncelle' : 'Kaydet' }}
  </button>
</div>

<!-- ğŸ“„ GeÃ§miÅŸ Listeleme -->
<div *ngIf="activeTab === 'list'">
  <button (click)="activeTab = ''"><i class="fa-solid fa-arrow-left"></i> Geri</button>

  <!-- ğŸ” Arama ve Filtre -->
  <div class="form-group">
    <input [(ngModel)]="searchKeyword" placeholder="TanÄ± veya tedavi ara..." />
    <select [(ngModel)]="searchField">
      <option value="diagnosis">TanÄ±</option>
      <option value="treatment">Tedavi</option>
    </select>
    <button (click)="searchHistories()"><i class="fa-solid fa-magnifying-glass"></i> Ara</button>

    <label><i class="fa-solid fa-clock"></i> Zaman Filtresi:</label>
    <select [(ngModel)]="selectedPeriod" (change)="loadHistories()">
      <option value="">TÃ¼mÃ¼</option>
      <option value="day">Son 1 GÃ¼n</option>
      <option value="week">Son 1 Hafta</option>
      <option value="month">Son 1 Ay</option>
      <option value="year">Son 1 YÄ±l</option>
    </select>
  </div>

  <h3><i class="fa-solid fa-list"></i> GeÃ§miÅŸ KayÄ±tlarÄ±</h3>

  <div *ngIf="histories.length === 0">
    <p><i class="fa-solid fa-circle-exclamation"></i> Bu hastaya ait geÃ§miÅŸ kaydÄ± bulunamadÄ±.</p>
  </div>

  <div *ngFor="let history of histories" class="history-card">
    <p><strong>TanÄ±:</strong> {{ history.diagnosis }}</p>
    <p><strong>Tedavi:</strong> {{ history.treatment || '-' }}</p>
    <p><strong>Notlar:</strong> {{ history.notes || '-' }}</p>
    <p><strong>Tarih:</strong> {{ history.date }}</p>
    <p><strong>Doktor:</strong> Dr. {{ history.doctor?.name.charAt(0) }}.{{ history.doctor?.surname }}</p>
    <button (click)="editHistory(history)">
      <i class="fa-solid fa-pen-to-square"></i> DÃ¼zenle
    </button>
    <button (click)="deleteHistory(history.id)">
      <i class="fa-solid fa-trash"></i> Sil
    </button>
  </div>
</div>
